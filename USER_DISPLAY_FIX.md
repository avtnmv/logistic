# Исправление отображения имени пользователя

## Проблема
В Header отображалось "undefined undefined" вместо имени пользователя.

## Причины
1. **Неправильные поля**: Header использовал `firstName`/`lastName`, а User интерфейс имеет `first_name`/`last_name`
2. **Сохранение в localStorage**: Пользователь сохранялся локально, что могло приводить к устаревшим данным

## Решение

### 1. Исправлено отображение имени в Header
**Файл**: `src/components/Header.tsx`

**Было:**
```typescript
{currentUser ? `${currentUser.firstName} ${currentUser.lastName}` : 'Пользователь'}
```

**Стало:**
```typescript
{currentUser ? 
  `${currentUser.first_name || ''} ${currentUser.last_name || ''}`.trim() || 'Пользователь' 
  : 'Пользователь'
}
```

### 2. Удалено сохранение пользователя в localStorage
**Файл**: `src/contexts/AuthContext.tsx`

**Изменения:**
- Удалены вызовы `authService.saveCurrentUser()`
- Удалены вызовы `authService.clearCurrentUser()`
- Добавлено логирование загрузки пользователя с сервера

### 3. Всегда загружать пользователя с сервера
**При перезагрузке страницы:**
1. Проверяется наличие токена аутентификации
2. Если токен есть - загружается пользователь с `/auth/me`
3. Если загрузка не удалась - очищаются токены
4. Пользователь НЕ сохраняется в localStorage

## Преимущества

### ✅ Актуальные данные
- Имя пользователя всегда актуальное с сервера
- Изменения профиля сразу отображаются

### ✅ Безопасность
- Нет устаревших данных в localStorage
- Токены проверяются при каждой загрузке

### ✅ Надежность
- Если токен недействителен - автоматический logout
- Нет проблем с синхронизацией данных

## Тестирование

### 1. Проверка отображения имени
1. Войдите в систему
2. Проверьте, что в Header отображается правильное имя
3. Обновите профиль пользователя
4. Перезагрузите страницу - имя должно обновиться

### 2. Проверка загрузки с сервера
1. Откройте консоль браузера
2. Перезагрузите страницу
3. Должны увидеть логи:
   ```
   Loading user from server...
   User loaded from server: {user data}
   ```

### 3. Проверка обработки ошибок
1. Истечение токена или проблемы с API
2. Должны увидеть:
   ```
   Auth check failed: [error]
   ```
3. Пользователь должен быть разлогинен

## Файлы изменены
- `src/components/Header.tsx` - исправлено отображение имени
- `src/contexts/AuthContext.tsx` - удалено localStorage, добавлена загрузка с сервера
- `src/components/AdminPanel.tsx` - добавлено логирование для отладки
